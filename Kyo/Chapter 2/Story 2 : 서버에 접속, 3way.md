# 02 . 서버에 접속

### 접속의 의미

---

소켓을 만든 직후에 애플리케이션에서 데이터 송신 의뢰가 오면 프로토콜 스택은 어떻게 동작할까

- socket을 호출하여 소켓을 만드는 동작만으로는 프로토콜 스택에 아무것도 전달되지 않는다.
- **서버의 IP주소나 포트번호를 프로토콜 스택에 알리는 동작이 필요**하고, 이것이 접속 동작의 한가지 역할이다.
- **서버 측은 클라이언트에 대한 정보를 아예 모른다. 서버측에 통신 동작의 개시를 전달하는 것**도 접속 동작의 역할이다.

### 접속 동작의 첫번째

- 통신 상대와의 사이에 제어 정보를 주고받아 소켓에 필요한 정보를 기록하고 데이터 송.수신 가능한 상태로 만드는 것이다.
    - 클라이언트측의 IP주소, 포트 번호를 서버측에 알려주는 것
    - 데이터를 송.수신할 때는 일시적으로 메모리 공간이 필요하다. → 버퍼 메모리
        - 버퍼 메모리의 확보도 접속 동작할 때 수행한다.

### 제어 정보를 기록한 헤더

ACK번호 : 데이터가 몇바이트까지 수신측에 잘 도착했는지 수신측에서 송신측에 다시 전달하기 위한 플래그

컨트롤 비트 : 여러 필드가 있는데 각각 통신 제어의 의미를 가지고있다.(SYN : 송신측, 수신측 일련번호 확인)

체크섬 :: 오류 유무 확인

- 이러한 제어정보들을 패킷의 제일 앞부분에 배치하고 **헤더**라고 부른다.
- 왜 헤더가 필요하나?
    - 소켓에 기록한 제어 정보는 상대측에서 못본다. → 소켓에 기록하는 제어정보는 프로토콜 스택을 만드는 사람(OS)마다 달라서 못 맞춘다.
    - **하지만 특정 규칙에 따라 헤더에 제어 정보를 기록하여 통신하면 그것으로 통신이 된다.**

### 실제 접속 동작 - TCP 3way hand shacking

애플리케이션이 Socket라이브러리의 connect를 호출해야한다.

- 호출하면 프로토콜 스택의 TCP 담당 부분에 전달된다.

![image](https://github.com/AlgoMango/Season2/assets/59204352/707a2b95-db86-408a-89c9-e05662042326)


1. 접속 소켓을 정하고, 컨트롤 비트의 SYN이라는 비트를 1로 만든다.
    - SYN : 송신, 수신측 확인하는 일련 번호

클라이언트 ———————SYN—————————> 서버

1. 서버는 수신처의 포트번호에 해당하는 소켓을 찾고, SYN 비트를  설정한 TCP헤더를 만든다.
그리고 ACK라는 컨트롤 비트를 1로 만들어서 보낸다.
    
    ACK : 패킷 받았다는 것을 알리는 동작
    

클라이언트 ←——————SYN, ACK ——————— 서버

1. 패킷이 클라이언트에게 오고 SYN이 1이므로 접속 성공이다.
    
    서버가 응답 돌려보낼때 ACK를 1로 만들었는데, 패킷이 도착한 것을 서버에 알리기 위해 ACK 비트를 1로 만들어서 TCP헤더를 반송한다.
    

클라이언트 ————————-ACK—————————→ 서버

- 이로써 소켓은 데이터를 송.수신할 수 있는 상태가 된 것이다.
- 이러한 커넥션(파이프)는 close를 호출하여 연결을 끊을 때까지 계속 존재한다.
