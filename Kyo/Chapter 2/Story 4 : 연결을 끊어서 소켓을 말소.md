## 04. 연결을 끊어서 소켓을 말소

### 데이터 보내기 완료시 연결을 끊는다.

- 데이터 송.수신을 종료하는 것은 애플리케이션이 송신해야 하는 데이터를 전부 송신 완료 했을 때이다.
- 데이터 보내기를 완료한쪽에서 연결 끊기 단계에 들어간다.
    - 완료한 쪽이 Socket 라이브러리의 `close`를 호출한다.

![스크린샷 2023-08-06 오후 10 31 06](https://github.com/Dylan-yoon/CS_Network/assets/59204352/21a206eb-da01-4387-9ee4-0fdb6d23ff15)

1. 서버측에서 보낸 FIN에 1을 설정한 TCP 헤더가 도착하면 클라이언트측의 프로토콜 스택은 자신의 소켓에 서버측의 연결 끊기 동작을 기록한다.-1
2. FIN을 1로 설정한 패킷을 받은 사실을 알리기 위해 서버측에 반송한다.-2
3. read를 호출하고, 서버에서 보낸 데이터를 전부 수신 완료했다는 사실을 클라이언트의 애플리케이션에 알린다.-2
4. 서버에서 보낸 데이터를 전부 수신하면 클라이언트도 종료한다.
5. 클라이언트측의 애플리케이션에서  close를 호출하여 끝낸다.
6. 클라이언트 측의 프로토콜 스택은 서버측과 마찬가지로 FIN비트에 1설정하고 서버에 송신한다.-3
7. ACK이 돌아오면 서버와의 대화가 끝난다.-4

### 소켓 말소

- 바로 소켓을 없애지 않는다.
    - 포트번호가 겹쳐서 새 소켓에 FIN이 도착할 수 있어서, 잠시 기다린다.

### 데이터 송.수신 동작을 정리

![스크린샷 2023-08-06 오후 10 31 18](https://github.com/Dylan-yoon/CS_Network/assets/59204352/ccc6dbb0-0d46-443d-a4d0-dc215b1f346e)
