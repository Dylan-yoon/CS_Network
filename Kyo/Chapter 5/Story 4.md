# 04. 캐시서버를 이용한 서버의 부하분산

### 01. 캐시 서버의 이용

---

분산 처리 방법은 아래와 같은 방법들이 있다.

- 여러 대의 같은 기능을 가진 서버를 설치하는 방법
- **캐시 서버**를 이용하는 방법

**캐시 서버**

- 캐시서버는 “**프록시**”라는 구조를 사용한 서버이다.

**프록시**

- 웹 서버와 클라이언트 사이에서 웹서버에 대한 액세스 동작을 중개하는 역할을 한다.
- 액세스 동작을 중개할 때, 웹 서버에서 받은 데이터를 디스크에 저장해 두고,
- 웹 서버를 대신하여 데이터를 클라이언트에 전송하는 기능을 가지고 있다.

→ 캐시

**왜 이런 것을 사용하나?**

- 웹 서는 URL 점검하거나, 액세스 권한 점검하거나,  처리하는 시간이 다소 걸린다.
- 캐시 서버는 웹서버에서 받은 데이터를 그대로 보내기만 하면 되서 빠르게 데이터를 클라이언트에게 보낼 수 있다.

**한계**

- 캐시에 데이터를 저장한 후, 웹 서버에서 해당 데이터가 변경되면 캐시의 데이터는 사용할 수 없게 된다.
- 하지만 일부분의 액세스 동작은 캐시서버에서 꾸준하게 처리할 수 있다.(데이터 변동성이 없는 데이터들 한정?)

캐시서버에서 리퀘스트를 처리하면 그만큼 웹서버의 부하가 줄면서 처리시간을 단축 시킬 수 있다.

### 02. 캐시 서버는 갱신일로 콘텐츠를 관리한다.

---

부하 분산 장치와 마찬가지로 캐시 서버를 웹 서버 대신 DNS 서버에 등록해야한다.

- 사용자가 볼 때, 캐시 서버가 웹 서버로 보인다.

<img width="512" alt="스크린샷 2023-08-27 오전 11 53 05" src="https://github.com/Dylan-yoon/CS_Network/assets/59204352/c3ba04bd-9716-48e0-ab51-1f542f797a1d">



- “콘텐츠변경없음”의 정보가 데이터를 보내는 패킷보다 적기 때문에 속도가 향상된다.

**한대의 캐시로 여러대의 서버의 데이터를 캐시에 저장하는 경우는?**

- 만약 요청 URI가 dir1이면 1번서버 , dir2면 2번서버로 캐시가 웹서버로 요청한다.
    - 설정을 보고 전송 대상을 판단하여 메세지를 전송한다.

**이렇게 클라이언트와 웹 서버 사이를 중개하는 것이 프록시 구조이다.**

- 중개할 때 데이터를 저장하면 캐시 서버의 데이터가 축적되고,
- 사용자가 액세스한 데이터가 캐시 서버에 저장되어있는 경우와 확률이 증가되며 빨라지게 된다.

변경여부는?

- 캐시가 웹서버에게 **“If-Modified-Since”**라는 헤더 필드를 추가하여 전송한다.
- 웹 서버가 해당 필드의 값과 데이터의 최종 갱신일시를 비교하며 변경이 있고, 없음을 판단하면서 캐시에게 데이터 변경 여부를 응답 메세지로 알린다.

### 03. 포워드 프록시

---

위의 설명은 프록시 구조를 웹 서버측에 두고 캐시 기능을 이용한 경우이다.

- 하지만 캐시 서버를 클라이언트 측에 두는 방법도 있다.

→ **포워드 프록시** 

포워드 프록시는 서버측에 설치하는 캐시와 같이 캐시 이용이 목적이지만, **방화벽 실현의 목적도 있었다.**

- URI부분에 URL을 그대로 기입한다.

프록시 도입 이유

- 방화벽은 부정 침입을 막는 것인다, 이목적을 달성하기 위해 패킷의 왕래를 모두 막는게 확실하다.
- 하지만 말이 안되므로, 프록시라는 구조로 프록시가 리퀘스트의 내용을 조사한 후, 리퀘스트의 내용에 따라 액세스가 가능한지 판단하는 것이다.

### 04. 리버스 프록시 (포워드 프록시 개선)

---

포워드 프록시는 브라우저에대한 설정이 필요하다.

하지만 인터넷의 공개 웹 서버들은 액세스하는 브라우저들의 설정을 일일이 알 수 없고, 할 수도 없다. 

이에 따라 브라우저에 프록시를 설정하지 않아도 사용할 수 있도록 개선되었다.

- 리퀘스트 메세지의 URI 부분의 디렉토리명과 웹서버를 대응시켜 일반 리퀘스트 메세지도 보낼수 있도록 바꿈

→ 서버측에 설치하는 캐시서버에 채택하는 방식 : 리버스 프록시

### 05. 트랜스페어런트 프록시

---

캐시 서버에서 전송 대상을 판단하는 방법 

- 패킷의 맨 앞에 있는 IP헤더에 수신처의 IP 주소가 기록되어 있는데,
    
    이것을 조사하여 액세스 대상 웹서버가 어디에있는 지알 수 있다. → 트랜스페어런트 프록시
