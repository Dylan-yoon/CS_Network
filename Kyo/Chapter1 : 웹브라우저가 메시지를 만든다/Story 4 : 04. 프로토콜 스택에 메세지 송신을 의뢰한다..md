# 04. 프로토콜 스택에 메세지 송신을 의뢰한다.

IP주소를 조사한 후, OS내부에 있는 프로토콜 스택에 의뢰해야한다.

- HTTP 메세지는 디지털 데이터 이므로 디지털 데이터를 송.수신해야한다.

파이프 같은 데이터 통로로 데이터가 양방향으로 전달 될 수 있다.

이 파이프의 양 끝이 데이터의 출입구이며, 소켓이라고 부른다.

### 단계 별 데이터 송.수신 동작

1. 소켓을 만든다.
2. 서버 측의 소켓에 파이프를 연결한다.
3. 데이터를 송.수신한다.
4. 파이프를 분리하고 소켓을 말소한다.

- 애플리케이션 자체에서 파이프를 연결하거나 데이터를 쏟아붓지 않고, **프로토콜 스택에 의뢰해서 파이프를 연결하거나 데이터를 쏟아 붓는 것이다.**
- DNS 서버에 조회 보낼 때와 동일하게 Socket 라이브러리의 프로그램 부품을 호출해야한다.

### 소켓 생성 단계

- `socket`이라는 프로그램 부품을 호출한다.
- 복수의 소켓이 컴퓨내에 존재할 수 있다.
    - 크롬 2개 띄우면 데이터 송수신이 2개가 동시에 진행되므로 2개의 소켓이 필요하다.
- 2개의 소켓을 어떻게 식별하나??
    - 소켓을 생성하면 **디스크립터**가 반환되는데, 이것을 메모리에 저장해둔다.
    - **디스크립터** :  소켓 식별자

### 파이프에 연결하는 접속 단계

- 만든 소켓을 서버측의 소켓에 접속하도록 프로토콜 스택에 의뢰한다.
- Socket 라이브러리의 `connect`라는 프로그램 부품을 호출하여 소켓에 접속을 실행
    - connect 호출 시, 디스크립터, IP 주소, 포트번호가 필요하다.
    - 디스크립터로 어느 소켓을 서버측의 소켓에 접속할 것인지 분별이 가능하다.
    - IP주소는 소켓까지 지정할 수 없어서 포트 번호까지 필요하다.
- **포트번호** : 포트번호는 세계적으로 지정된 규칙이 있다. 웹은 80, 메일은 25

### 메세지를 주고 받는 송.수신 단계

- 송신 : `write`라는 프로그램 부품을 사용한다.
- 수신 : `read`라는 부품을 사용한다.

### 연결 끊기 단계

- Socket라이브러리에 있는 `close`라는 프로그램 부품을 호출한다.
- 브라우저가 데이터 수신을 완료하면 송.수신 동작은 끝난다.
- 웹서버가 먼저 close호출해서 연결을 끊고, 이것이 클라이언트에게 전달되어서 연결이 끊어진다.
