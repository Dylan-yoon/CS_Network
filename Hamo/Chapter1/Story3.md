# Story3. 전 세계의 DNS 서버가 연대한다

## DNS 서버의 기본 동작

- DNS 서버의 기본 동작은 클라이언트에서 조회 메시지를 받고 조회의 내용에 응답하는 형태로 정보를 회답하는 일이다.
    - 조회 메시지에 포함되는 세 가지 정보
        - 이름
            - 서버나 메일 배송 목적지와 같은 이름
        - 클래스
            - 인터넷 이외의 네트워크에서의 이용까지 고려해서 이를 식별하기 위해 사용하는 정보
            - 인터넷은 IN
        - 타입
            - 이름에 어떤 타입의 정보가 지원되는지를 나타냄
            - 타입이 A이면 IP 주소, MX이면 메일 배송 목적지가 지원된다.
            - 이 정보의 내용에 따라 클라이언트에 회답하는 정보의 내용이 달라진다.  


        <img width="528" alt="스크린샷 2023-07-30 오후 4 05 35" src="https://github.com/Dylan-yoon/CS_Network/assets/85005933/e4da4c9e-faf4-44be-95ac-46c96d9bb25f">

        
- 조회 메시지를 보내면 DNS 서버에서 리소스 레코드에 기록되어 있는 정보랑 비교해서 찾아서 클라이언트에 보내준다.
- 웹 서버에는 www로 시작하는 이름을 붙인 것이 많지만 모두 이런 규칙이 있는 것은 아니다.
    - 처음 웹의 구조를 만들 때 www라는 이름으로 웹 서버를 등록한 것이 많았기 때문에 관례가 된 것이다.
- 타입이 MX인 경우에는 메일 서버의 우선 순위와 메일 서버의 이름이라는 두 항목이 등록되어 있다. 따라서 두 개의 항목을 회답한다. 그리고 메일 서버의 IP 주소도 함께 회답한다.
- 타입은 IP, MX 이외에도 엄청 많다.

## DNS 서버 구조

- 인터넷에는 막대한 수의 서버가 있으므로 이것을 전부 1대의 DNS 서버에 등록하는 것은 불가능하다.
- 정보를 분산시켜서 다수의 DNS 서버에 등록하고 서로서로 연대해서 어디에 정보가 등록되어 있는지를 찾아내는 구조로 되어있다.

## 도메인의 계층

- DNS 서버에 등록한 정보에는 모든 도메인명이라는 계층적 구조를 가진 이름이 붙어져있다.
- DNS에서 취급하는 이름은 점으로 구분되어 있는데, 이 점이 계층을 구분한다.
    - 오른쪽에 위치한 것이 상위의 계층을 나타낸다.
- 하나의 도메인을 하나의 DNS 서버에 일괄적으로 등록한다.
    - 하나의 도메인을 여러대의 DNS 서버에 등록하는 것은 불가능하다.
    - 하나의 DNS 서버에 여러개의 도메인을 등록할 수는 있다.
- www.cyber.co.kr이라는 도메인은 아래와 같은 구조이다.
    - 최상위의 kr 도메인은 대한민군에 할당된 도메인
    - 그 하위의 co라는 도메인은 국내의 도메인을 분류하기 위해 설치된 도메인
        - 회사를 나타낸다.
    - 그 애라에 cyber가 회사에 할당된 도메인
    - 최하위인 www가 서버의 이름이다.

## DNS 서버에 등록한 정보를 찾아내는 방법

- 액세스 대상의 웹 서버가 어느 DNS 서버에 등록되어 있는지를 찾아내는 방법
    - 하위 도메인을 담당하는 DNS서버의 IP 주소를 그 상위의 DNS 서버에 등록한다.
- com, kr 상위에 루트 도메인이라는 도메인이 있다.
    - 루트 도메인에는 이름이 없으므로 보통 생략한다.
    - 명시적으로 써야 한다면 끝에 마침표를 찍어서 나타낸다.
- 루트 도메인의 DNS 서버를 인터넷에 존재하는 DNS 서버에 전부 등록한다.
    - 어느 DNS 서버도 루트 도메인에 액세스할 수 있다.
    - 클라이언트에서 어딘가의 DNS 서버에 액세스하면 루트 도메인을 경유하여 목적지에 도착한다.
    - 루트 도메인의 DNS 서버에 할당된 IP 주소는 13개밖에 없다.
    - 실제로 루트 도메인의 DNS 서버에 관한 정보는 DNS 서버 소프트웨어와 함께 배포되어 있으므로 설치하면 자동으로 등록이 완료된다.
- 찾아가는 과정은 아래와 같다.
    
    <img width="300" height = "400" alt="스크린샷 2023-07-30 오후 5 04 18" src="https://github.com/Dylan-yoon/CS_Network/assets/85005933/3cbf4df2-b9d0-4655-a63d-eac1ec190439">

    

## DNS 서버 캐시

- 현실의 인터넷에서는 한대의 DNS 서버에 복수 도메인의 정보를 등록해둔다. (상위랑 하위를 같이 할 수도 있음)
- 한 번 조사한 이름을 캐시에 기록할 수 있다.
- 이름이 존재하지 않는다는 회답도 캐시할 수 있다.
- 캐시 정보가 올바르지 않을 수도 있기 때문에 유효 기한을 설정해둔다.
