# Story2.  웹 서버의 IP 주소를 DNS 서버에 조회한다.

HTTP의 메시지를 만들면 OS에 의뢰해서 액세스 대상의 서버에게 송신한다.

OS에 송신을 의뢰할 때는 도메인명이 아니라 IP주소로 상대를 지정해야 하기 때문에 IP 주소를 조사해야한다.

## IP

- 인터넷이나 사내 LAN은 TCP/IP 개념에 기초하여 만들어졌다.
    - 서브넷이라는 작은 네트워크를 라우터로 접속하여 전체 네트워크가 만들어진다.
    - 서브넷은 허브에 몇 대의 PC가 접속된 것으로 생각하면 된다. - 3장에서 자세하게 배움
- xx동 xx번지 형태로 네트워크의 주소를 할당한다.
    - xx동을 서브넷 (네트워크 번호), xx번지를 컴퓨터(호스트 번호)에 할당
    - 두개를 합치면 IP 주소라고 한다.
- 액세스 대상의 서버까지 메시지를 운반할 때 이 주소에 따라 어디에 있는지 판단한다.
- 32비트의 디지털 데이터로 8비트씩 점으로 구분하여 10진수로 표기한다.
    - 10.11.12.13
- 네트워크 번호인지 호스트 번호인지 구분하기 위해 `넷마스크`라는 정보를 붙인다.
    - 넷마스크가 1인 부분 → 네트워크 번호
    - 넷마스크가 0인 부분 → 호스트 번호
    - 10.11.12.13 / 255.255.255.0 → (IP 주소 본체) / (넷마스크)
    - 10.11.12.13/24 → 1인 비트 개수로 나타낼 수도 있다.
- 호스트 번호가 모두 0이면 기기가 아니라 서브넷 자체를 나타낸다.
- 호스트 번호가 모두 1이면 서브넷에 있는 기기 전체에 패킷을 보내는 브로드캐스트를 나타낸다.

## 도메인명 vs IP

- IP주소는 32비트, 즉 4바이트에 해당하는 개수 밖에 없지만 도메인명은 최소 수십 바이트부터 최대 255바이트 까지 있다.
- 그만큼 라우터가 부하되어 데이터를 운반하는 동작에 더 많은 시간이 걸리면서 네트워크 속도가 느려진다.
- 도메인명은 길이도 결정되어 있지 않아서 효율성이 떨어진다.
- 사람은 이름을 사용하고 라우터는 IP를 주소를 사용하도록 하는게 DNS이다. (이름 ↔ IP)

## IP 주소를 조사하는 방법

- 가장 가까운 DNS 서버를 조회하면 된다.
- DNS 서버에 조회한다는 것은 메시지를 보내고 응답을 받는것이다. 즉, DNS 서버에 대해서 클라이언트로 동작하는 것이다. 이때 클라이언트에 해당하는게 DNS 리졸버이다.
- DNS 원리를 사용해서 IP 주소를 조사하는 것을 네임 리졸루션이라고 한다. (이걸 실행하는건 리졸버)
- 리졸버는 Socket 라이브러리 안에 들어있다.
- Socket 라이브러리는 OS에 포함되어 있는 네트워크의 기능을 어플리케이션에서 호출하기 위한 부품을 모아 놓은 것이다.

## 리졸버

- 리졸버 프로그램 이름이랑 웹 서버 이름을 쓰기만 하면 리졸버를 호출할 수 있다.
- 호출하면 응답이 돌아오는데 그 안에 IP 주소가 포함되어있다.
- 내부 동작
    - 호출하면 제어가 리졸버로 넘어감
    - DNS 서버에 보낼 메시지를 만듬
    - 메시지 송신 동작은 OS의 내부에 포함된 프로토콜 스택을 호출하여 실행을 의뢰
    - LAN 어댑터를 통해 메시지가 DNS 서버를 향해 송신됌
    - DNS 서버가 수신해서 메시지에 조회 내용을 조사해서 결과를 클라이언트에 반송
    - 프로토콜 스택 → 리졸버 → 리졸버가 내용 해독 → IP 추출해서 어플리케이션에 전달
    - 제어가 다시 어플리케이션으로 돌아옴 끝
- DNS 서버의 IP 주소도 필요한데 이것은 컴퓨터에 미리 설정되어 있음
