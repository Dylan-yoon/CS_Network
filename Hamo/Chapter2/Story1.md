# Story1. 소켓을 작성한다.

OS에 내장된 네트워크 제어용 소프트웨어(프로토콜 스택)와 네트워크용 하드웨어(LAN 어댑터)가 브라우저에서 받은 메시지를 서버에서 송출하는 동작을 탐험한다.

## 프로토콜 스택의 내부 구성


<img width="500" alt="스크린샷 2023-08-03 오전 1 25 58" src="https://github.com/Dylan-yoon/CS_Network/assets/85005933/3b198a0b-8459-409d-9a72-c3d1ec6328ab">

- 제일 위에는 네트워크 어플리케이션 계층이 있다.
    - 1장에서 본 DNS 서버를 조회하는 동작이 일어난다.
    - 전체적인 의뢰 동작이 아래로 향하여 일어남
- 그 아래는 OS 내부를 나타내며 이곳에 프로토콜 스택이 있다.
    - 데이터 송,수신을 담당하는 TCP, UDP → 의뢰를 받아서 송, 수신 동작을 실행한다.
        - 간략하게 TCP는 브라우저나 메일 등의 일반적인 어플리케이션에서 사용한다.
        - UDP는 DNS 서버에 대한 조회 등에서 짧은 제어용 데이터를 송, 수신하는 경우에 사용한다.
    - IP 프로토콜을 사용하여 패킷 송, 수신 동작을 제어하는 부분이 있다.
        - 인터넷에서 데이터를 운반할 때 데이터를 작게 나누어 패킷이라는 형태로 운반한다.
        - IP의 주역할이 이 패킷을 목적지 까지 운반하는 것이다.
        - ARP랑 ICMP 프로토콜을 다루는데 나중에 배운다.
- LAN 드라이버는 LAN 어댑터의 하드웨어를 제어한다.
- 그 아래 LAN 어댑터가 실제 케이블에 대해 신호를 송, 수신하는 동작을 수행한다.

## 소켓의 실체

- 프로토콜 스택은 내부에 제어 정보를 기록해둔다.
    - 통신 상대의 IP 주소, 포트 번호, 진행 상태 등등
- 이 제어 정보를 소켓의 실체라고 생각해도 좋다.
- 프로토콜 스택은 이 제어 정보를 참조하면서 동작한다.

<img width="1288" alt="스크린샷 2023-08-03 오전 1 25 58" src="https://github.com/Dylan-yoon/CS_Network/assets/85005933/07658abb-55dd-47b3-a351-2f8986664a7c">

위 사진에서 한 행이 소켓에 해당한다. (제어 정보)

소켓을 만든다는 것은 위에 새로운 제어 정보를 추가하고 통신을 준비하는 작업이다.

## Socket을 호출했을 때

- 소켓을 만드는 단계
    - 프로토콜 스택은 처음으로 소켓 한 개 분량의 메모리 영역을 확보한다.
    - 해당 메모리 영역에 초기 상태라는 것을 기록한다.
    - 만들어진 후 디스크립터를 어플리케이션에 알려준다.
