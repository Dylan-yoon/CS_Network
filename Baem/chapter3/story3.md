## Story_03 라우터의 패킷 중계 동작

IP와 이더넷의 차이점

라우터의 내부 구조
- 중계 부분 -> 패킷의 중계 대상을 판단하는 동작 담당
- 포트 부분 -> 패킷의 송수신 담당

라우터의 포트부분
- 포트부분에서 패킷 수신 (포트부분 하드웨어에 의뢰해 패킷 수신)
  - 포트 부분(각 부분들은 규칙에 따라 동작 실행한다.)
    - ADSL
    - FTTH
    - 전용 회선
    - 무선 LAN
    - 이더넷
  - 라우터의 각 포트에는 MAC 주소가 할당되어 있다.
라우터의 중계 부분
- 테이블을 사용해 중계 대상을 조사
  - 라우터는 IP 헤더에 기재되어 있는 수신처 IP 중계 대상을 판단한다.
  - 경로표
    - 수신처: 서브넷 자체의 주소
    - 넷마스크
    - 게이트웨이 -> 패킷의 중계 대상
    - 인터페이스 -> 패킷의 중계 대상
    - 메트릭 -> 목적지 까지 거리가 가까운지 먼지를 나타냄(클수록 멀다.)


### 라우터의 패킷 수신 동작
라우터의 패킷 수신 동작
1. 신호가 커넥터 부분에 도착
2. 커넥터 안쪽의 PHY 회로와 MAC 회로에서 신호를 디지털 데이터로 변환
3. FCS 대조, 오류 유무 점검

### 경로표를 통한 중계 동작
중계동작
1. 수신한 패킷의 수신처 IP 주소와 경로표의 수신처 항복을 조사하여 해당 행 찾음
2. IP 주소가 일치하면 중계 대상 후보가 된다.
   - 네트워크 번호, 서브넷 등 고려해서 중계할 대상을 찾는다.
   - 우회로를 두는 경우 메트릭 값을 이용해 판단한다. (작은 값 선택)


### 패킷의 유효기간
TTL(Time To Live) 생존기간
패킷이 같은 장소를 맴도는 것을 막기 위해 TTL을 지정해 라우터 경유 할 때마다 1식줄어들어 0이 되면 패킷을 만료 시킨다.

### 큰 패킷을 조각으로
PPPoE(PPP over Ethernet) : 광대역 회선을 제어하는 방식

LAN 의 종류에 따라 패킷의 최대길이가 달라지므로 적절하게 패킷을 조각내서 중계한다.

TCP 의 경우 데이터가 저장되기 전에 분할<br>
조각 나누기의 경우는 패킷의 데이터가 저장되어 있는 상태로 패킷을 분할 하는 것<br>
* `TCP 헤더 + 데이터` 를 라우터가 하나의 데이터로 간주하기 때문에 TCP 헤더 또한 데이터에 포함된다.

### 라우터에서 패킷 송신
라우터의 패킷 송신은 출력 포트에 따라 각자 규칙에 맞는 패킷으로 변환하여 송신한다.

라우터
- 서로다른 네트워크를 연결
- 데이터 패킷이 네트워크를 통과하여 대상에 도달하는 경로를 선택한다.
스위치
- 장치를 상호간에 연결 해준다.
