# 라우터의 부가 기능

## 주소 변환
(사내) 네트워크에 프라이빗 주소를 할당하고, 인터넷과 직ㅈ버 패킷을 주고받지 않도록 하는 구조

### 등장 배경
- 컴퓨터가 많아져서 나타난 주소 부족 현상을 해결하기 위해
- 글로벌 주소(global address): 인터넷과 직접 통신하는 공개용 서버에 할당. unique
- 프라이빗 주소(private address): 같은 네트워크 내에서만 중복되지 않으면 된다. 인터넷과 직접 패킷을 주고 받지 않음.

### 동작 과정
주소 변환의 구조: 패킷을 중계할 때 IP 헤더에 기록된 IP 주소와 포트 번호(TCP/UDP 포트 번호)를 바꿔쓰는 것

1. 패킷을 인터넷에 중계할 때 송신처 IP 주소를 프라이빗 주소에서 글로벌 주소로 변경, 포트 번호도 변경
   - 글로벌 주소 = 주소 변환 장치의 인터넷 측 포트에 할당된 주소
   - 포트 번호 = 미사용 번호 중 적절한 것을 선택
     - 포트 번호를 바꿔 쓰지 않으면 프라이빗 주소와 글로벌 주소의 수가 1:1로 대응해야 하기 때문
2. 변경 전 프라이빗 주소와 포트 번호, 변경 후 글로벌 주소와 포트 번호를 주소 변환 장치 내부의 대응표에 기록
3. 변경한 패킷을 인터넷에 송출
4. 서버로부터 회신 패킷 수신
5. 회신 패킷의 글로벌 주소와 포트 번호를 대응표를 보고 프라이빗 주소와 포트 번호로 변경
6. 사내 네트워크에 패킷 전송
7. 송신처에 응답 패킷 도착

## 패킷 필터링
패킷을 중계할 때 MAC 헤더, IP 헤더, TCP 헤더를 조사해 사전 설정한 조건과 비교하여 패킷을 중계 또는 폐기

방화벽(기기 또는 소프트웨어)이 이 원리를 사용
