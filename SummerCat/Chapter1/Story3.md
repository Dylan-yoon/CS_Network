# 전 세계의 DNS 서버가 연대한다.

### DNS 서버의 기본 동작
- 클라이언트에서 조회 메시지를 받고, 조회의 내용에 응답하는 형태로 정보를 회답
- 조회 메시지에 포함되어 있는 정보
  - 이름: 서버나 메일 배송 목적지(메일 주소에서 @ 뒷부분) 같은 이름
  - 클래스: 항상 `IN`이라는 값을 가짐 (인터넷을 나타냄)
  - 타입: 이름에 어떤 타입(종류)의 정보가 지원되는지를 나타냄. 타입에 따라 클라이언트에 회답하는 정보의 내용이 달라짐.
- DNS 서버에는 각 정보에 대응하여 클라이언트에 회답하는 항목이 등록되어 있음.

### 도메인의 계층
DNS 서버에 등록한 정보에는 모두 `도메인명`이라는 이름이 붙여져 있다.
  - 도메인명은 계층적 구조를 가리킴
  - 예: `www.google.apple.com`의 경우
    - `.`으로 계층을 구분
    - 오른쪽에 위치한 것이 상위 계층
    - 도메인: `com`, `google`, `apple`
    - 이름: `www`

최상위 도메인: `com`, `kr` 등

루트 도메인: `com`, `kr` 등의 상위 도메인
  - 루트 도메인에는 `com`, `kr` 같은 도메인명이 없으므로 보통 생략한다.
  - 루트 도메인의 DNS 서버를 인터넷에 존재하는 모든 DNS 서버에 등록

### 동작 과정
예: 이름이 `www.google.apple.com`인 서버의 IP 주소를 조회하는 경우
  1. 클라이언트가 다음과 같은 정보를 포함한 조회 메시지를 가장 가까운 DNS 서버에 보냄
      - 이름 = www.google.apple.com
      - 클래스 = IN
      - 타입 = A
  2. DNS 서버가 등록된 정보를 찾아서 이름, 클래스, 타입 세 가지가 모두 일치하는 것을 찾아 해당 정보를 클라이언트에 회답
  3. 일치하는 정보가 없을 경우, 루트 도메인의 DNS 서버에 클라이언트로부터 받은 조회 메시지 전송
  4. 루트 도메인의 DNS 서버에 등록되어 있는 `com` 도메인의 DNS 서버의 IP 주소를 반송
  5. `1`의 DNS 서버가 `com` 도메인의 DNS 서버에 조회 메시지 전송
  6. ... 원하는 DNS 서버에 도달할 때까지 반복
  7. 원하는 DNS 서버에 도달해서 조회에 대한 답(IP 주소)를 클라이언트에 회답

### DNS 서버의 캐시
DNS 서버에도 캐시가 존재한다.
  - 조사한 이름을 캐시에 기록할 수 있다. (해당 이름이 존재하는 경우, 아닌 경우 모두 기록)
  - 캐시에 저장된 정보가 유효하지 않을 수 있기 때문에,
    1. DNS 서버에 등록하는 정보에 유효 기간을 설정하고, 캐시에 저장한 데이터의 유효 기간이 지나면 삭제
    2. 조회에 회답할 때 캐시에 저장된 정보인지, 등록처 DNS 서버에서 회답한 것인지 알려준다.
