# 서버에 접속한다

소켓을 만들면 애플리케이션은 `connect`를 호출해서, 프로토콜 스택이 클라이언트 측 소켓을 서버 측 소켓에 접속한다.

## 접속 동작
1. 통신 상대와의 사이에 제어 정보를 주고받아 소켓에 필요한 정보를 기록하고, 데이터 송수신이 가능한 상태로 만드는 것
   - 예: 클라이언트 측 IP 주소나 포트 번호를 서버측에 알리는 것
   - 접속 동작에서 주고 받는 제어 정보는 통신 규칙으로 정해져 있음.
2. 버퍼 메모리 확보
   - 버퍼 메모리: 송수신하는 데이터를 일시적으로 저장하는 메모리 영역

### 제어 정보
- 클라이언트-서버가 서로 연락을 절충하기 위해 주고 받는 제어 정보로, 헤더에 기입
- 소켓에 기록하여 프로토콜 스택의 동작을 제어하기 위한 정보
  - 송수신 동작의 진행 상호아, 애플리케이션이 통지한 정보, 통신 상대로부터 받은 정보 등

### 접속 동작 단계
1. 애플리케이션이 `connect` 호출
   - 서버 측 IP 주소와 포트 번호를 넣는다.
   - 명령이 프로토콜 스택의 TCP 담당 부분에 전달
2. 클라이언트 측 TCP 담당 부분이 서버측 TCP 담당 부분과 제어 정보를 주고 받음
   - 데이터 송수신 동작의 개시를 나타내는 제어 정보를 기록한 TCP 헤더 생성
   - TCP 헤더의 송신처와 수신처의 포트 번호로 접속하는 소켓 지정
3. 생성한 TCP 헤더를 IP 담당 부분에 전달해서 송신 의뢰
4. IP 담당 부분이 패킷 송신 동작 실행
5. 네트워크를 통해 패킷이 서버에 도착
6. 서버측 IP 담당 부분이 TCP 헤더를 조사해 수신처 포트 번호에 해당하는 소켓을 찾아냄
7. 해당 소켓에 필요한 정보를 기록하고, 접속 동작이 진행 중 상태가 됨
8. 서버의 TCP 담당 부분이 응답을 돌려보냄
9. 클라이언트에 패킷이 돌아오면 해당 패킷의 TCP 헤더의 SYN 비트가 1인지 확인
   - 1이면 접속 성공 → 소켓에 접속 완료를 나타내는 제어 정보 기록
   - ACK 비트가 1인 TCP 헤더를 서버 측에 반송해서 패킷이 도착한 것을 서버에 알림
10. 서버 측에 해당 TCP 헤더가 도착하면 접속 동작 끝
    - 소켓이 데이터를 송수신 할 수 있는 상태가 됨(연결됨)
    - 데이터 송수신 동작을 계속하는 동안에는 접속(connnection)이 유지된다.
    - `close`를 호출해 연결이 끊기면 끊긴다.
